<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shopping Cart</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header class="header">
    <h1>Sweet Treats</h1>
    <nav class="nav">
      <a href="home.html">Home</a>
      <a href="shop.html">Shop</a>
      <a href="cart.html">Cart</a>
      <a href="login.html">Login</a>
    </nav>
  </header>
  <main style="padding:28px;max-width:800px;margin:0 auto">
    <h2 style="font-size:2rem;margin-bottom:24px">Shopping Cart</h2>
    <div id="cart-items" style="background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--light-brown);margin-bottom:20px;min-height:200px"></div>
    <div style="background:var(--card);padding:20px;border-radius:12px;border:1px solid var(--light-brown);text-align:right">
      <div style="font-size:1.4rem;font-weight:700;color:var(--accent);margin-bottom:20px">Total: $<span id="total">0.00</span></div>
      <button id="checkout" style="padding:14px 28px;font-size:1rem">Proceed to Checkout</button>
    </div>
  </main>
  <script src="products.js"></script>
  <script>
function loadCart(){
  if(!window.PRODUCTS || window.PRODUCTS.length === 0){
    setTimeout(loadCart, 100);
    return;
  }
  try {
    var cartData = localStorage.getItem('bakery_cart');
    var cart = cartData ? JSON.parse(cartData) : [];
    if(!Array.isArray(cart)) cart = [];
    var container = document.getElementById('cart-items');
    var total = 0;
    if(cart.length === 0){
      container.innerHTML = '<p style="color:var(--muted);text-align:center;padding:20px">Your cart is empty</p>';
    } else {
      var html = '<table style="width:100%;border-collapse:collapse">';
      html += '<tr style="border-bottom:2px solid var(--light-brown)"><th style="text-align:left;padding:10px">Item</th><th style="text-align:center;padding:10px">Qty</th><th style="text-align:center;padding:10px">Actions</th><th style="text-align:right;padding:10px">Price</th></tr>';
      for(var i=0;i<cart.length;i++){
        var item = cart[i];
        var product = window.PRODUCTS.find(p => p.id === item.id);
        if(!product) continue;
        var price = product.price * item.qty;
        total += price;
        html += '<tr style="border-bottom:1px solid var(--light-brown)"><td style="padding:10px">'+product.name+'</td><td style="text-align:center;padding:10px"><span id="qty-'+product.id+'">'+item.qty+'</span></td><td style="text-align:center;padding:10px"><button class="qty-btn" data-id="'+product.id+'" data-action="minus" style="padding:4px 8px;margin:0 2px;background:var(--light-brown);border:none;border-radius:4px;cursor:pointer">−</button><button class="qty-btn" data-id="'+product.id+'" data-action="plus" style="padding:4px 8px;margin:0 2px;background:var(--accent);color:#fff;border:none;border-radius:4px;cursor:pointer">+</button><button class="qty-btn" data-id="'+product.id+'" data-action="remove" style="padding:4px 8px;margin:0 2px;background:#c0392b;color:#fff;border:none;border-radius:4px;cursor:pointer">✕</button></td><td style="text-align:right;padding:10px"><span id="price-'+product.id+'">$'+price.toFixed(2)+'</span></td></tr>';
      }
      html += '</table>';
      container.innerHTML = html;
      
      document.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', function(){
          var id = parseInt(this.getAttribute('data-id'), 10);
          var action = this.getAttribute('data-action');
          var item = cart.find(c => c.id === id);
          if(!item) return;
          
          if(action === 'plus'){
            item.qty++;
          } else if(action === 'minus'){
            item.qty--;
            if(item.qty < 1) item.qty = 1;
          } else if(action === 'remove'){
            cart = cart.filter(c => c.id !== id);
          }
          
          localStorage.setItem('bakery_cart', JSON.stringify(cart));
          loadCart();
        });
      });
    }
    document.getElementById('total').textContent = total.toFixed(2);
    document.getElementById('checkout').onclick = function(){
      if(cart.length === 0) { alert('Cart is empty'); return; }
      location.href = 'checkout.html';
    }
  } catch(err) {
    console.error('Error loading cart:', err);
    document.getElementById('cart-items').innerHTML = '<p style="color:red">Error loading cart</p>';
  }
}
if(document.readyState === 'loading'){
  document.addEventListener('DOMContentLoaded', loadCart);
} else {
  loadCart();
}
  </script>
</body>
</html>